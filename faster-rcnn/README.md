# Task 2: Faster R-CNN

Since we cannot upload large files to GitHub, we leave out some large images, the VOC dataset, and the trained models. And you can download our models in our repo's releases. And the structure of this repo is the full version of the repo (not the one you see here). And you can add these files to where they should exist at.

The changes are:

Add [frcnn_modelA.pth](https://github.com/Tequila-Sunrise/FDU-Computer-Vision-Final/releases/download/publish/frcnn_modelA.pth), [frcnn_modelB.pth](https://github.com/Tequila-Sunrise/FDU-Computer-Vision-Final/releases/download/publish/frcnn_modelB.pth), [frcnn_modelC.pth](https://github.com/Tequila-Sunrise/FDU-Computer-Vision-Final/releases/download/publish/frcnn_modelC.pth) to folder logs.

Add [mask_rcnn_pretrained_backbone.pth](https://github.com/open-mmlab/mmdetection/tree/master/configs/mask_rcnn) to folder model_data.

Add the VOC datasets to VOCdevkit (not provided).

## The Structure of this Repo

```
.
├── README.md
├── VOCdevkit: to put the VOC datasets in.
├── frcnn.py
├── get_map.py
├── logs
│   ├── frcnn_modelA.pth
│   ├── frcnn_modelB.pth
│   ├── frcnn_modelC.pth
│   └── (Other logs)
├── model_data
│   ├── change_backbone.ipynb: The file to load the backbone of Mask R-CNN.
│   ├── mask_rcnn_pretrained.pth: The randomly initialized model with Mask R-CNN's pretrained backbone.
│   ├── mask_rcnn_pretrained_backbone.pth: The pretrained Mask R-CNN model from mmLab.
│   ├── resnet50-19c8e357.pth
│   └── voc_classes.txt
├── nets
│   ├── __init__.py
│   ├── classifier.py
│   ├── frcnn.py
│   ├── frcnn_training.py
│   ├── resnet50.py
│   ├── rpn.py
│   └── vgg16.py
├── predict.py
├── summary.py
├── train.py: run this to train the model
├── utils
│   ├── __init__.py
│   ├── anchors.py
│   ├── callbacks.py
│   ├── dataloader.py
│   ├── util_miou.py
│   ├── utils.py
│   ├── utils_bbox.py
│   ├── utils_fit.py
│   └── utils_map.py
├── voc_train.txt: Will be generated by voc_annotation.py.
├── voc_val.txt: Will be generated by voc_annotation.py.
└── voc_annotation.py: run this script first.
```

## Training and Predicting Process

1. Since we cannot upload the VOC dataset into Github, so before training, you need to download the VOC dataset and unzip it to folder VOCdevkit.
2. Run `voc_annotation.py` to generate voc_train.txt and voc_val.txt.
3. Change the setting shown in the table below.
4. Change the model path, and run `train.py` to start training.
5. To evaluate the model, change the model_path to the model's path, and classes_path to the classes' path in file frcnn.py. After that, run `get_map.py`, the model's mAP will show in the terminal.

## Settings

| model   | pretrained setting                               | freeze train epoch | unfreeze train epoch |
| ------- | ------------------------------------------------ | ------------------ | -------------------- |
| model A | `pretrained=False` (in train.py)                 | 0                  | 150                  |
| model B | `pretrained=True` (in train.py)                  | 50                 | 100                  |
| model C | run `change_backbone.ipynb` in folder model_data | 50                 | 100                  |

## Result

| model                                                        | backbone                         | mAP0.5 |
| ------------------------------------------------------------ | -------------------------------- | ------ |
| [model A](https://github.com/Tequila-Sunrise/FDU-Computer-Vision-Final/releases/download/publish/frcnn_modelA.pth) | ResNet-50 Random Initialized     | 58.17  |
| [model B](https://github.com/Tequila-Sunrise/FDU-Computer-Vision-Final/releases/download/publish/frcnn_modelB.pth) | ResNet-50 Pretrained on ImageNet | 80.39  |
| [Model C](https://github.com/Tequila-Sunrise/FDU-Computer-Vision-Final/releases/download/publish/frcnn_modelC.pth) | ResNet-50 Mask R-CNN's Backbone  | 81.11  |

## Reference

This repo is mainly derived from https://github.com/bubbliiiing/faster-rcnn-pytorch.

